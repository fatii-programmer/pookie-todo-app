"use strict";(()=>{var t={};t.id=873,t.ids=[873],t.modules={2934:t=>{t.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:t=>{t.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:t=>{t.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:t=>{t.exports=require("crypto")},629:t=>{t.exports=require("fs/promises")},5315:t=>{t.exports=require("path")},2254:t=>{t.exports=require("node:buffer")},6005:t=>{t.exports=require("node:crypto")},7261:t=>{t.exports=require("node:util")},5503:(t,e,a)=>{a.r(e),a.d(e,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>w,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var r={};a.r(r),a.d(r,{POST:()=>l});var n=a(9303),i=a(8716),s=a(670),o=a(7070),u=a(9487),c=a(9178),d=a(4087);async function l(t){try{let{email:e,password:a}=await t.json();if(!e||!a)return o.NextResponse.json({error:"Email and password are required"},{status:400});let r=await (0,u.PR)(e);if(!r||!await (0,c.Gv)(a,r.passwordHash))return o.NextResponse.json({error:"Invalid credentials"},{status:401});let n=await (0,c.V3)(r.id);await (0,d.ar)("user_login",r.id,void 0,{email:r.email});let i=o.NextResponse.json({success:!0,userId:r.id});return i.cookies.set("token",n,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"}),i}catch(t){return console.error("Login error:",t),o.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\pte\\Desktop\\hackathon-2\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:w,staticGenerationAsyncStorage:f,serverHooks:y}=p,m="/api/auth/login/route";function g(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},9178:(t,e,a)=>{a.d(e,{Gg:()=>w,Gv:()=>d,V3:()=>l,c_:()=>c});var r=a(6091),n=a(6176),i=a(1615),s=a(2023),o=a.n(s);let u=new TextEncoder().encode(process.env.JWT_SECRET||"default-secret-change-me");async function c(t){return o().hash(t,10)}async function d(t,e){return o().compare(t,e)}async function l(t){return new r.N({userId:t}).setProtectedHeader({alg:"HS256"}).setExpirationTime("7d").sign(u)}async function p(t){try{return(await (0,n._)(t,u)).payload}catch{return null}}async function w(){let t=(0,i.cookies)(),e=t.get("token")?.value;return e?p(e):null}},9487:(t,e,a)=>{a.d(e,{Ak:()=>y,PR:()=>w,_5:()=>x,gI:()=>m,r4:()=>f,xJ:()=>g});var r=a(629),n=a.n(r),i=a(5315),s=a.n(i),o=a(4087);let u=process.env.DATABASE_PATH||"./data/tasks.json",c=null;async function d(){try{await n().access(u)}catch{let t=s().dirname(u);await n().mkdir(t,{recursive:!0});let e={version:"3.0.0",users:[],tasks:{},metadata:{nextId:{},lastModified:new Date().toISOString()}};await n().writeFile(u,JSON.stringify(e,null,2))}}async function l(){return c||(await d(),c=JSON.parse(await n().readFile(u,"utf-8")))}async function p(t){t.metadata.lastModified=new Date().toISOString(),c=t,await n().writeFile(u,JSON.stringify(t,null,2))}async function w(t){return(await l()).users.find(e=>e.email===t)||null}async function f(t){let e=await l();e.users.push(t),await p(e),await (0,o.ar)("user_signup",t.id,void 0,{email:t.email,createdAt:t.createdAt})}async function y(t){return(await l()).tasks[t]||[]}async function m(t,e){let a=await l();a.tasks[t]||(a.tasks[t]=[],a.metadata.nextId[t]=1);let r=a.metadata.nextId[t];a.metadata.nextId[t]++;let n={...e,id:r};return a.tasks[t].push(n),await p(a),await (0,o.ar)("todo_created",t,n.id,{description:n.description,priority:n.priority,tags:n.tags}),n}async function g(t,e,a){let r=await l(),n=r.tasks[t]||[],i=n.findIndex(t=>t.id===e);if(-1===i)return null;let s=n[i],u={...s,...a,id:e};return r.tasks[t][i]=u,await p(r),void 0!==a.completed?a.completed&&!s.completed?await (0,o.ar)("todo_completed",t,e,{description:u.description}):!a.completed&&s.completed&&await (0,o.ar)("todo_uncompleted",t,e,{description:u.description}):await (0,o.ar)("todo_updated",t,e,{updates:a,description:u.description}),u}async function x(t,e){let a=await l(),r=a.tasks[t]||[],n=r.findIndex(t=>t.id===e);if(-1===n)return!1;let i=r[n];return a.tasks[t].splice(n,1),await p(a),await (0,o.ar)("todo_deleted",t,e,{description:i.description}),!0}},4087:(t,e,a)=>{a.d(e,{ar:()=>l,lD:()=>w});var r=a(629),n=a.n(r),i=a(5315),s=a.n(i);let o=process.env.HISTORY_PATH||"./history";async function u(){try{await n().access(o)}catch{await n().mkdir(o,{recursive:!0})}}async function c(t){await u();let e=s().join(o,t);try{let t=await n().readFile(e,"utf-8");return JSON.parse(t)}catch{return[]}}async function d(t,e){await u();let a=s().join(o,t);await n().writeFile(a,JSON.stringify(e,null,2))}async function l(t,e,a,r){let n;let i={id:`${Date.now()}-${Math.random().toString(36).substring(2,9)}`,timestamp:new Date().toISOString(),userId:e,actionType:t,todoId:a,metadata:r};n="user_signup"===t||"user_login"===t||"user_logout"===t?"login-history.json":"todo-history.json";let s=await c(n);return s.push(i),await d(n,s),await p(e,i),i}async function p(t,e){let a=s().join(o,"users");try{await n().access(a)}catch{await n().mkdir(a,{recursive:!0})}let r=s().join(a,`${t}.json`),i=[];try{let t=await n().readFile(r,"utf-8");i=JSON.parse(t)}catch{}i.push(e),await n().writeFile(r,JSON.stringify(i,null,2))}async function w(t,e){let a=await c("todo-history.json");return t&&(a=a.filter(e=>e.userId===t)),void 0!==e&&(a=a.filter(t=>t.todoId===e)),a}}};var e=require("../../../../webpack-runtime.js");e.C(t);var a=t=>e(e.s=t),r=e.X(0,[276,881,972],()=>a(5503));module.exports=r})();